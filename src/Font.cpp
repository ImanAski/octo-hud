#include "pico_hud/Font.h"
#include <cstring>

namespace pico_hud {

// Simple 8x8 monospace font bitmap data (ASCII 32-126)
// Each character is 8 bytes (8x8 bits)
static const uint8_t font_8x8_data[] = {
  // Space (32)
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  // ! (33)
  0x18, 0x3C, 0x3C, 0x18, 0x18, 0x00, 0x18, 0x00,
  // " (34)
  0x36, 0x36, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  // # (35)
  0x36, 0x36, 0x7F, 0x36, 0x7F, 0x36, 0x36, 0x00,
  // $ (36)
  0x0C, 0x3E, 0x03, 0x1E, 0x30, 0x1F, 0x0C, 0x00,
  // % (37)
  0x00, 0x63, 0x33, 0x18, 0x0C, 0x66, 0x63, 0x00,
  // & (38)
  0x1C, 0x36, 0x1C, 0x3B, 0x6E, 0x66, 0x3F, 0x00,
  // ' (39)
  0x06, 0x06, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00,
  // ( (40)
  0x18, 0x0C, 0x06, 0x06, 0x06, 0x0C, 0x18, 0x00,
  // ) (41)
  0x06, 0x0C, 0x18, 0x18, 0x18, 0x0C, 0x06, 0x00,
  // * (42)
  0x00, 0x66, 0x3C, 0xFF, 0x3C, 0x66, 0x00, 0x00,
  // + (43)
  0x00, 0x0C, 0x0C, 0x3F, 0x0C, 0x0C, 0x00, 0x00,
  // , (44)
  0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x06, 0x00,
  // - (45)
  0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00,
  // . (46)
  0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x0C, 0x00,
  // / (47)
  0x60, 0x30, 0x18, 0x0C, 0x06, 0x03, 0x01, 0x00,
  // 0 (48)
  0x3E, 0x63, 0x73, 0x7B, 0x6F, 0x67, 0x3E, 0x00,
  // 1 (49)
  0x0C, 0x0E, 0x0C, 0x0C, 0x0C, 0x0C, 0x3F, 0x00,
  // 2 (50)
  0x1E, 0x33, 0x30, 0x1C, 0x06, 0x33, 0x3F, 0x00,
  // 3 (51)
  0x1E, 0x33, 0x30, 0x1C, 0x30, 0x33, 0x1E, 0x00,
  // 4 (52)
  0x38, 0x3C, 0x36, 0x33, 0x7F, 0x30, 0x78, 0x00,
  // 5 (53)
  0x3F, 0x03, 0x1F, 0x30, 0x30, 0x33, 0x1E, 0x00,
  // 6 (54)
  0x1C, 0x06, 0x03, 0x1F, 0x33, 0x33, 0x1E, 0x00,
  // 7 (55)
  0x3F, 0x33, 0x30, 0x18, 0x0C, 0x0C, 0x0C, 0x00,
  // 8 (56)
  0x1E, 0x33, 0x33, 0x1E, 0x33, 0x33, 0x1E, 0x00,
  // 9 (57)
  0x1E, 0x33, 0x33, 0x3E, 0x30, 0x18, 0x0E, 0x00,
  // : (58)
  0x00, 0x0C, 0x0C, 0x00, 0x00, 0x0C, 0x0C, 0x00,
  // ; (59)
  0x00, 0x0C, 0x0C, 0x00, 0x00, 0x0C, 0x06, 0x00,
  // < (60)
  0x18, 0x0C, 0x06, 0x03, 0x06, 0x0C, 0x18, 0x00,
  // = (61)
  0x00, 0x00, 0x3F, 0x00, 0x00, 0x3F, 0x00, 0x00,
  // > (62)
  0x06, 0x0C, 0x18, 0x30, 0x18, 0x0C, 0x06, 0x00,
  // ? (63)
  0x1E, 0x33, 0x30, 0x18, 0x0C, 0x00, 0x0C, 0x00,
  // @ (64)
  0x3E, 0x63, 0x7B, 0x7B, 0x7B, 0x03, 0x1E, 0x00,
  // A (65)
  0x0C, 0x1E, 0x33, 0x33, 0x3F, 0x33, 0x33, 0x00,
  // B (66)
  0x3F, 0x66, 0x66, 0x3E, 0x66, 0x66, 0x3F, 0x00,
  // C (67)
  0x3C, 0x66, 0x03, 0x03, 0x03, 0x66, 0x3C, 0x00,
  // D (68)
  0x1F, 0x36, 0x66, 0x66, 0x66, 0x36, 0x1F, 0x00,
  // E (69)
  0x7F, 0x06, 0x06, 0x3E, 0x06, 0x06, 0x7F, 0x00,
  // F (70)
  0x7F, 0x06, 0x06, 0x3E, 0x06, 0x06, 0x06, 0x00,
  // G (71)
  0x3C, 0x66, 0x03, 0x03, 0x73, 0x66, 0x7C, 0x00,
  // H (72)
  0x33, 0x33, 0x33, 0x3F, 0x33, 0x33, 0x33, 0x00,
  // I (73)
  0x3F, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x3F, 0x00,
  // J (74)
  0x78, 0x30, 0x30, 0x30, 0x33, 0x33, 0x1E, 0x00,
  // K (75)
  0x67, 0x66, 0x36, 0x1E, 0x36, 0x66, 0x67, 0x00,
  // L (76)
  0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x7F, 0x00,
  // M (77)
  0x63, 0x77, 0x7F, 0x6B, 0x63, 0x63, 0x63, 0x00,
  // N (78)
  0x63, 0x67, 0x6F, 0x7B, 0x73, 0x63, 0x63, 0x00,
  // O (79)
  0x1C, 0x36, 0x63, 0x63, 0x63, 0x36, 0x1C, 0x00,
  // P (80)
  0x3F, 0x66, 0x66, 0x3E, 0x06, 0x06, 0x06, 0x00,
  // Q (81)
  0x1E, 0x33, 0x33, 0x33, 0x3B, 0x1E, 0x38, 0x00,
  // R (82)
  0x3F, 0x66, 0x66, 0x3E, 0x36, 0x66, 0x67, 0x00,
  // S (83)
  0x1E, 0x33, 0x07, 0x0E, 0x38, 0x33, 0x1E, 0x00,
  // T (84)
  0x3F, 0x2D, 0x0C, 0x0C, 0x0C, 0x0C, 0x1E, 0x00,
  // U (85)
  0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x3F, 0x00,
  // V (86)
  0x33, 0x33, 0x33, 0x33, 0x33, 0x1E, 0x0C, 0x00,
  // W (87)
  0x63, 0x63, 0x63, 0x6B, 0x7F, 0x77, 0x63, 0x00,
  // X (88)
  0x63, 0x63, 0x36, 0x1C, 0x1C, 0x36, 0x63, 0x00,
  // Y (89)
  0x33, 0x33, 0x33, 0x1E, 0x0C, 0x0C, 0x1E, 0x00,
  // Z (90)
  0x7F, 0x63, 0x31, 0x18, 0x4C, 0x66, 0x7F, 0x00,
  // [ (91)
  0x1E, 0x06, 0x06, 0x06, 0x06, 0x06, 0x1E, 0x00,
  // \ (92)
  0x03, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x40, 0x00,
  // ] (93)
  0x1E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x1E, 0x00,
  // ^ (94)
  0x08, 0x1C, 0x36, 0x63, 0x00, 0x00, 0x00, 0x00,
  // _ (95)
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,
};

static Glyph font_8x8_glyphs[95];

const Font font_8x8 = {
  .height = 8,
  .baseline = 7,
  .glyphs = font_8x8_glyphs,
  .glyph_count = 95,
  .first_char = 32,
  .last_char = 126
};

// Initialize glyphs
static struct FontInitializer {
  FontInitializer() {
    for (size_t i = 0; i < 95; i++) {
      font_8x8_glyphs[i] = {
        .width = 8,
        .height = 8,
        .x_offset = 0,
        .y_offset = 0,
        .x_advance = 8,
        .bitmap = &font_8x8_data[i * 8]
      };
    }
  }
} font_initializer;

const Glyph* FontRenderer::getGlyph(const Font& font, char c) {
  if (c < font.first_char || c > font.last_char) {
    return nullptr;
  }
  size_t index = c - font.first_char;
  if (index >= font.glyph_count) {
    return nullptr;
  }
  return &font.glyphs[index];
}

uint16_t FontRenderer::measureText(const Font& font, const char* text) {
  uint16_t width = 0;
  while (*text) {
    const Glyph* glyph = getGlyph(font, *text);
    if (glyph) {
      width += glyph->x_advance;
    }
    text++;
  }
  return width;
}

} // namespace pico_hud

